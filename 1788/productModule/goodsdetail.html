<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta type="description" content="行业代理-商品详情">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Cache-Control" content="no-cache">
	<meta http-equiv="Expires" content="0">
    <title>商品详情</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../plugs/layui/css/layui.css">
    <link rel="stylesheet" href="../font/font_399822_dtv8v5xokcfvfgvi/iconfont.css">
    <link rel="stylesheet" href="../plugs/font-awesome/css/font-awesome.min.css" media="all">
    <link rel="stylesheet" href="../css/publicHead.css">
    <link rel="stylesheet" href="../css/goodsdetail.css">
</head>
<body>
	<div class="layui-layout layui-layout-admin" id="goodsDetail">
		<!--顶部导航开始-->
		<div class="layui-header">
			<!-- 头部区域（可配合layui已有的水平导航） -->
			<nav class="navbox">
				<ul class="layui-nav layui-layout-left">
					<li class="layui-nav-item" id="userCenter">
					</li>
				</ul>
				<ul class="layui-nav layui-layout-right" id="commonHeader">
				</ul>
			</nav>
		</div>
		<!--顶部导航结束-->

			<!-- logo + 搜索 +进货单 开始-->
			<div class="grid_total" id="repeat_search"></div>
			<!-- logo + 搜索 +进货单 结束-->

		<!-- 第二个nav 开始-->
		<div class="secondNav" id="secondNav">
			<div class="grid_wrap">
				<div class="seller-left layui-inline" id="sellerLeft"></div>
				<div class="layui-inline grid_wrap_item" id="focusSuppliers" style="min-width: 105px">
					<a href="javascript:;" data-focus="false">
						<i class="fa fa-star-o"></i>
						<span>关注供应商</span>
					</a>
				</div>
				<div class="layui-inline grid_wrap_item ">
					<a href="javascript:;" class="contactSupplier">
						<i class="fa fa-commenting-o"></i>
						<span>联系供应商</span>
					</a>
				</div>
				<div class="layui-inline grid_wrap_item" id="sellerCompany">
					<a>
						<i class="fa fa-hospital-o" aria-hidden="true"></i>
						<span></span>
					</a>
				</div>
			</div>
		</div>
		<!-- 第二个nav  结束-->

		<!-- 商品信息  开始-->
		<div class="goodsInfo">
			<div class="leftImgShow">
				<div class="bigImgBox">
					<img src="../img/placeholder-big.jpg" />
				</div>
				<div class="smallImgBox">
					<a href="javascript:;" class="btn-a left-btn-a" id="gd_prevA"><i class="fa fa-chevron-left"></i></a>
					<ul id="pictureInfo"></ul>
					<a href="javascript:;" class="btn-a right-btn-a" id="gd_nextA"><i class="fa fa-chevron-right"></i></a>
				</div>
				<div class="setBox">
					<!-- <div class="layui-inline" id="goodsInfo-hare">
						<a href="javascript:;">
							<i class="fa fa-share-alt" aria-hidden="true"></i>
							<span>分享</span>
						</a>
					</div> -->
					<div class="layui-inline" id="focusProduct">
						<a href="javascript:;">
							<i class="fa fa-star-o" data-focus="false"></i>
							<span>收藏</span>
						</a>
					</div>
					<!-- <div class="layui-inline" id="goodsInfo-activities">
						<a href="javascript:;">
							<i class="fa fa-gift"></i>
							<span>有奖调查</span>
						</a>
					</div>
					<div class="report layui-layout-right">
						<a href="javascript:;">
							<span>举报</span>
						</a>
					</div>
					-->
				</div>
			</div>
			<div class="middleInfo">
				<span class="layui-badge firstToThree layui-hide" id="isPromotion">特价</span>
				<div class="info-title">
					<p></p>
				</div>
				<div class="infoPriceList">
					<table border="0px" cellspacing="0" cellpadding="0">
						<tr id="unifiedPrice">
							<td><span class="pr_title">全国统一零售价：</span></td>
							<td><i>￥</i><em></em></td>
						</tr>
						<tr id="listPrice">
							<td><span class="pr_title">我连网供货价：</span></td>
							<td class="orange"><i>￥</i><em></em></td>
						</tr>
					</table>
				</div>
				<div class="info-priceRange layui-hide">
					<div class="pr_content">
						<div class="pr_content_box">
							<table border="0px" cellspacing="0" cellpadding="0">
								<tr id="buyPrice">
									<!--<td><span class="pr_title">价格</span></td>
									<td class="orange"><i>￥</i><em>230.</em>00</td>
									<td class="orange"><i>￥</i><em>222.</em>50</td>
									<td class="orange"><i>￥</i><em>210.</em>00</td>-->
								</tr>
								<tr id="minNum">
									<!--<td><span class="pr_title">区间</span></td>
									<td>5-9件</td>
									<td>10-49 件</td>
									<td>≥50 件</td>-->
								</tr>
							</table>
						</div>
					</div>
				</div>
				<div class="info-other">
					<table border="0px" cellspacing="0" cellpadding="0">
						<!--<tr class="salesPromo">
							<td><span class="pr_title">促销：</span></td>
							<td><span class="orange">本店满600元可用30元补货券，支持跨店使用</span></td>
						</tr>-->
						<tr class="distribution" id="distribution">
							<td><span class="pr_title">配送：</span></td>
							<td>
								<span id="freightStratAddress"></span>
								至
								<select name="province" id="province"></select>
								<!-- 快递
								<select name="courier" id="expressList"></select>
								-->
								<span id="freightTotalPrice"></span>
							</td>
						</tr>
						<tr>
							<td><span class="pr_title">购买限制：</span></td>
							<td>
								<label>
									最小购买量&nbsp;<span id="minBuyNumSpan"></span>&nbsp;
									<span class="unitNameSpan"></span>
								</label>
								<label>
									最大购买量&nbsp;<span id="maxBuyNumSpan"></span>&nbsp;
									<span class="unitNameSpan"></span>
								</label>
							</td>
						</tr>
						<tr class="specifications" id="skuList"></tr>
						<tr class="specifications" id="skuMap"></tr>
					</table>
					<div class="presaleInfo layui-hide" id="presaleInfo">
						<span>预售商品：</span>
						<span id="presaleDate"></span>
						<span id="presaleType"></span>
					</div>
					<div class="submitBox">
						<a href="javascript:;" class="buyNow" onclick="buyNow();">立即购买</a>
						<a href="javascript:;" class="AddtoCart" onclick="addToCart(this);"><i class="fa fa-shopping-cart"></i>&nbsp;&nbsp;加入进货单</a>
					</div>
				</div>
			</div>
			<div class="rightBusinessmenRecommend">
				<!-- <h2 class="rbr_title">商家推荐</h2>
				<ul>
					<li>
						<span class="rbr_parice">￥129.00</span>
						<img src="../img/busnessRecom01.png" width="160px" height="160px" />
					</li>
					<li>
						<span class="rbr_parice">￥129.00</span>
						<img src="../img/busnessRecom02.png" width="160px" height="160px" />
					</li>
					<li>
						<span class="rbr_parice">￥129.00</span>
						<img src="../img/busnessRecom03.png" width="160px" height="160px" />
					</li>
				</ul>
				<div class="rbr_set">
					<img src="../img/drop-down-img.png"/>
					<img src="../img/drop-up-img.png"/>
				</div>
			</div> -->
		</div>
		<!-- 商品信息  结束-->

		<div class="gd-container">
		  <!--主体内容开始-->
	    <div class="grid_wrap">
	    	<div class="cont-leftBox">
	    		<!-- <div class="module cont-left-head">
	    			<h2>南昌家电</h2>
	    			<div class="into-store">
	    				<a href="javascript:;">
	    					<i class="fa fa-hospital-o"></i>
	    					进店逛逛
	    				</a>
	    			</div>
	    			<div class="focus-store">
	    				<a href="javascript:;">
		    				<i class="fa fa-star-o"></i>
		    				关注店铺
		    			</a>
	    			</div>
	    		</div> -->
	    		<div class="module cont-left-search" style="border: none">
	    			<!-- <div class="search-title">
	    				店内搜索
	    			</div>
	    			<div class="search-content">
	    				<div class="content-row">
	    					<label for="">关键字</label>
	    					<input type="text" name="keyword" id="" value="" />
	    				</div>
	    				<div class="content-row">
	    					<label for="">价&emsp;格</label>
	    					<input type="text" class="cont-price priceBegin" name="priceBegin" id="priceBegin" value="" />
	    					到
	    					<input type="text" class="cont-price priceEnd" name="priceEnd" id="priceEnd" value="" />
	    				</div>
	    			</div> -->
	    			<!-- <div class="search-title">
							店内搜索记录
	    			</div> -->
	    			<!-- <div class="search-content">
	    				<ul id="storeSearch">
	    					<li>
	    						<i class="search-plus-i"></i>
	    						<span>热卖爆款</span>
	    					</li>
	    				</ul>
	    			</div> -->
	    		</div>
	    		<div class="cont-left-hotSell" style="margin-top: 0">
	    			<div class="hotSell-title">
	    				店铺热销
	    			</div>
	    			<div class="hotSell-content">
	    				<ul id="hotSellBox"></ul>
	    			</div>
	    		</div>
	    	</div>
				<div class="cont-rightBox">
					<div class="layui-tab layui-tab-brief orange-tab" lay-filter="docDemoTabBrief">
						<ul class="layui-tab-title">
							<li class="layui-this">商品介绍</li>
							<li>商品属性</li>
							<li>工厂企业信息</li>
						</ul>
						<div class="layui-tab-content" style="min-height: 100px;">
							<div class="layui-tab-item layui-show" style="text-align: center; padding-top: 50px;" id="productIntroduce">
								<!--商品介绍-->
							</div>
							<div class="layui-tab-item attributes-list" id="productAttribute">
								<!--商品属性-->
								<ul id="productAttrUl">

								</ul>
							</div>
							<div class="layui-tab-item" id="factoryInfo">
								<!--工厂企业信息-->
								<ul id="factoryInfoUl">
									<li class="factoryLogo" id="factoryLogo" style="width:25%;">
										<img src="../img/placeholder.jpg" width="100px" height="100px" />
									</li>
									<li style="width:35%;">
										<h1 id="sellerCompanyName-h1" style="font-size:20px;font-weight:700;"></h1>
										<label class="contactWay" id="contactWay">
											<span>联系方式</span>
											<i class="fa fa-mobile-phone"></i>
										</label>
										<label class="woXinContact">
											<span>我信联系</span>
											<i class="fa fa-commenting-o fa-fw contactSupplier"></i>
										</label>
									</li>
									<li style="width:35%;">
										<label class="factoryComAddressBox">
											<span>所在地：</span>
											<span id="factoryComAddress"></span>
										</label>
									</li>
								</ul>
								<div id="factoryMsg"></div>
							</div>
						</div>
					</div>
				</div>
	    </div>
	    <!--主体内容结束-->

	    <!--右侧悬停 区域  开始-->
			<!-- <div class="rightTools" id="rightTools">
				<ul>
					<li>
						<a href=" ../buyCartModule/cart/index.html" target="_blank" class="toolsLeft">进货单</a>
						<a href=" ../buyCartModule/cart/index.html" target="_blank" class="toolsRight"><i class="fa fa-shopping-cart"></i></a>
					</li>
					<li>
						<a href="javascript:;" class="toolsLeft">电话</a>
						<a href="javascript:;" class="toolsRight"><i class="fa fa-phone"></i></a>
					</li>
					<li>
						<a href="javascript:;" class="toolsLeft">回顶部</a>
						<a href="javascript:;" class="toolsRight"><i class="fa fa-angle-up"></i></a>
					</li>
				</ul>
			</div> -->
			<!--右侧悬停 区域  结束-->
		</div>
		<div class="container" style="padding: 10px 0px;">
			<p style="font-size: 12px;color: #666666;text-align: center">2016-2019&copy;深圳我和网科技有限公司</p>
		</div>
	</div>





<script src="../plugs/layui/layui.all.js"></script>
<script src="../js/wolianwComponent/config.js"></script>
<script src="../js/goodsDetails.js"></script>
<script src="../js/main.js"></script>

<script>
    layui.use(['element','jquery', "woLianw"], function () {
        var element = layui.element;
        var $ = layui.jquery;
        var woLianw = layui.woLianw;
        window.productDetails = {};
        //运费模板传参
        window.freightParameter = {};
		//获取商品ID
		var productId = window.location.href.split('?productId=')[1];
				//var productId = 254;

        woLianw.getProductDetail({"productId": productId}, function(data){
        	console.log(data);
			productDetails = data;
			var totalDatas = JSON.parse(localStorage.getItem("1788login"));
			console.log(totalDatas);
			$("#userName").html('<i class="fa fa-user fa-fw" aria-hidden="true"></i> '+totalDatas.companyName);
			var category = goodsDetails(data.path);
			//获取进货单 num
			woLianw.buyCartSum(function(response){
				$("div.shopping-cart").find("span.layui-badge").html(response.data);
			});

			$("#sellerLeft").append(category); //面包屑导航

			$(".contactSupplier").click(function(){   //联系供应商
				var parameter = {
					id: productDetails.vendorId,
					formType: "FULL"
				}
				woLianw.contactSupplier(parameter, function(data){
					window.open(data, "_blank");
				});
			});

			$("#focusSuppliers a").click(function(){  //关注供应商
				var that = this;
				var arr = [];
				arr.push(productDetails.vendorId);
				var isFocus = $(this).attr("data-focus") == "true";

				if(!isFocus){  //点击关注
					var parameter = {
						disFollowType: 1,  //关注类型：1.工厂 2.商品
						itemIds: arr.join(",")
					}
					woLianw.focusSuppliers(parameter, function(response){
						layer.msg(response.msg);
						if(response.code == 1 && response.msg.indexOf("关注成功") != -1){
							$(that).find("span").html("已关注供应商");
							$(that).attr("data-focus", "true");
							$(that).parent().toggleClass("ischecked");
						}
					});
				}else if(isFocus){  //点击取消关注
					var parameter = {
						type: 1,  //关注类型：1.工厂 2.商品
						itemId: productDetails.vendorId
					}
					woLianw.cancelFocusSuppliers(parameter, function(response){
						layer.msg(response.msg);
						if(response.code == 1 && response.msg.indexOf("取消成功") != -1){
							$(that).find("span").html("关注供应商");
							$(that).attr("data-focus", "false");
							$(that).parent().toggleClass("ischecked");
						}
					});
				}

			});


			//页面初始化 先调用 查看当前商品是否已收藏
			woLianw.focusSuppliersStatus({"productId": productId}, function(response){  //回显商品收藏
				if(response.data){
					$("#focusProduct a").attr("data-focus", "true");
					$("#focusProduct").addClass("ischecked");
					$("#focusProduct a span").html("已收藏");

				}else{
					$("#focusProduct a").attr("data-focus", "false");
					$("#focusProduct").removeClass("ischecked");
				}
			});

			//页面初始化 先调用 查看当前供应商是否已关注
			woLianw.focusVendorStatus({"vendorId": productDetails.vendorId}, function(response){  //回显供应商关注
				if(response.data){
					$("#focusSuppliers a").attr("data-focus", "true");
					$("#focusSuppliers").addClass("ischecked");
					$("#focusSuppliers a span").html("已关注供应商");
				}else{
					$("#focusSuppliers a").attr("data-focus", "false");
					$("#focusSuppliers").removeClass("ischecked");
				}
			});

			$("#focusProduct a").click(function(){  //收藏商品
				var that = this;
				var arr = [];
				arr.push(productId);
				var isFocus = $(this).attr("data-focus") == "true";
				if(!isFocus){  //点击关注
					var parameter = {
						disFollowType: 2,  //关注类型：1.工厂 2.商品
						itemIds: arr.join(",")
					}
					woLianw.focusSuppliers(parameter, function(response){

						if(response.code == 1 && response.msg.indexOf("关注成功") != -1){
							layer.msg("收藏成功！");
							$(that).find("span").html("已收藏");
							$(that).attr("data-focus", "true");
							$(that).parent().toggleClass("ischecked");
						}
					});
				}else if(isFocus){  //点击取消收藏
					var parameter = {
						type: 2,  //关注类型：1.工厂 2.商品
						itemId: productId
					}
					woLianw.cancelFocusSuppliers(parameter, function(response){
						if(response.code == 1 && response.msg.indexOf("取消成功") != -1){
							layer.msg("取消收藏！");
							$(that).find("span").html("收藏");
							$(that).attr("data-focus", "false");
							$(that).parent().toggleClass("ischecked");
						}
					});
				}

			});

        	$("#sellerCompany span").html(data.vendorName);  //工厂名称
        	$("#sellerCompanyName-h1").html(data.vendorName);  //工厂名称
        	$(".info-title").find("p").text(data.name);
			leftSmallImg(data.pictureInfoList, "pictureInfo"); //渲染左侧商品小图片
			var bigImgSrc = (productDetails.pictureInfoList !=null) ? woLianw.getImgUrl(productDetails.pictureInfoList[0]) : "";
        	$("div.bigImgBox img").attr("src", bigImgSrc);//左侧展示大图

			woLianw.getLinkage(-1, function(data){			//配送区域
				freightArea(data, totalDatas.provinceId);
				getFreightPrice(productDetails);
        	});

			//如果是特价 就显出特价标识  如果不是就跳过（默认隐藏）
			data.isPromotion ? $("#isPromotion").removeClass("layui-hide") : "";  

			$("#minBuyNumSpan").html(data.minBuyNum); //最小购买量
			if(data.maxBuyNum){
				$("#maxBuyNumSpan").html(data.maxBuyNum); //最大购买量
			}else{
				$("#maxBuyNumSpan").parent().remove();
			}

        	$(".unitNameSpan").html(data.unitName); //计量单位
        	//如果canNotBuy 为true  不让购买 把 立即购买 和 加入购物车 置灰
        	if(data.canNotBuy || data.onOffState != 1 ){  //onOffState:0(下架)   1(上架)     2(强制下架)
				$.each([$("a.buyNow"), $("a.AddtoCart")], function(){
					$(this).attr("disabled", "true");
				});
				$("a.buyNow").parent().mouseover(function(){
					layer.msg("限制地区，不能购买！", {time: 1500});
				})

			}else if(!data.canNotBuy && data.onOffState){
				$("a.buyNow, a.AddtoCart").removeAttr("disabled");
			}

        	//渲染sku 规格属性
        	//woLianw.renderDataHtml(data.skuMap, "specificationsTemplate", "specifications");
			getSkuList(data.skuInfoList, data.skuMap, data.unitName);

			//我连网供货价
			//var listPrice = priceChange(productDetails.listPrice);
			$("#listPrice").find("em").text(productDetails.listPrice);

			//全国统一零售价
			//var unifiedPrice = priceChange(productDetails.unifiedPrice);
			$("#unifiedPrice").find("em").text(productDetails.unifiedPrice);

			//我连供货价

        	//如果阶梯价格的商品
        	if(data.priceType == 1){
        		$("div.info-priceRange").removeClass("layui-hide");
        		getPriceRange(data.ladderPriceList, data.unitName);
        		//渲染
        	}else{
        	//如果普通价格的商品
	        	$("div.info-priceRange").addClass("layui-hide");
	        	//woLianw.renderDataHtml(data.ladderPriceList, "buyPriceTemplate", "buyPrice");
			}

			if(data.isPresale){
				$("#presaleInfo").removeClass("layui-hide");
				$("#presaleDate").html(woLianw.transDateType(data.presaleDate));
				presaleType ? $("#presaleType").html("前发货") : $("#presaleType").html("开始发货");
			}

        	//渲染商品介绍
        	$("#productIntroduce").html(productDetails.content);

			//渲染商品属性（spu(properties)
        	$("#productAttrUl").html(getProductAttr(productDetails.properties));

        	//渲染工厂企业信息
        		//工厂logo
        	var $venderLogo = $("#factoryLogo > img");
			if(productDetails.vendorLogo){  //如果verderlogo 不为空
				var imgUrl = woLianw.getImgUrl(productDetails.vendorLogo);
        		$venderLogo.attr("src", imgUrl);
        	}else{
				$venderLogo.attr("src", "../img/placeholder.jpg");
			}
        	//工厂所在地
        	if(productDetails.province || productDetails.city || productDetails.area){
        		var str = productDetails.province + productDetails.city+ productDetails.area;
        		$("#factoryComAddress").html(str);
        		$("#freightStratAddress").html(str);
			}
			//富文本传过来的 工厂详情信息
			woLianw.getFactoryDetail({"vendorId": productDetails.vendorId}, function(data){
				$("#factoryMsg").html(data);
			});


        	//店内搜索
        	var searchkeyData =  window.localStorage.getItem("searchkey");
			var $storeSearch = storeSearch(searchkeyData);
			$("#storeSearch").html($storeSearch);

			//店铺热销
			var arr = [];
			arr.push(productDetails.vendorId);
			var parameter = {  //调接口需要的传参
				"vendorId": arr.join(","),  //工厂id
				"page":1,
				"sortColumn": "sale_count",
				"sortOrder": "desc",
				"limit": 5
			}
			hotSell(parameter);


        });




        $("#skuList").on("click","a.skuListA", function(){
        	$(this).addClass("checked").siblings().removeClass("checked");
        })



        //点击回到顶部
        $("#rightTools").find("li").eq(2).click(function() {
			$("html, body").animate({ scrollTop: 0 }, "slow");
			return false;
		});

		//商品详情 展示图片 左右按钮切换
		$("#gd_prevA").click(function(){
			if($("#pictureInfo li").length >= 5){
				var $first = $("#pictureInfo li:first");
				$("#pictureInfo").stop(true).animate({
					//left: -72+"px"
				}, 300, function(){
					var $elem= $first.clone(true);
					$first.remove();
					$("#pictureInfo li:last").after($elem);
					$("#pictureInfo li:first").trigger("click");
				});
			}

		});

		$("#gd_nextA").click(function(){
			if($("#pictureInfo li").length >= 5){
				var $last = $("#pictureInfo li:last");
				$("#pictureInfo").stop(true).animate({
					//left: -72+"px"
				}, 300, function(){
					var $elem= $last.clone(true);
					$last.remove();
					$("#pictureInfo li:first").before($elem);
					$("#pictureInfo li:first").trigger("click");
				});
			}

		});



		$(function(){
			//sku数量 加减框
			$("#skuMap").on("click", "span i", function(){
				var $inpNum = parseInt($(this).parent().siblings("input").val());
				if($(this).hasClass("fa-minus")){
					if($inpNum !=0){
						$(this).parent().siblings("input").val($inpNum-1);
						//getFreightPrice(productDetails, $inpNum-1);
					}
				}else if($(this).hasClass("fa-plus")){
					var str = $(this).parents("td").prev().text();
					var canSellNum = parseInt(str.split(" ")[0]);  //可售数量
					if($inpNum+1 <= canSellNum){
						$(this).parent().siblings("input").val($inpNum+1);
						//getFreightPrice(productDetails, $inpNum+1);
					}else{
						$(this).parent().siblings("input").val(canSellNum);
						layer.msg("不能超过可售数量！");
					}

				}
			});

			// $("#skuMap").on("blur", "input", function(){

			// });

			$("#skuMap").on("keyup", "input.gd-btn", function(){
				var c = $(this);
				if(/[^\d]/.test(c.val())){ //替换非数字字符
					var temp_amount=c.val().replace(/[^\d]/g,'');
					$(this).val(temp_amount);
				}

				var str = $(this).parent("td").prev().text();
				var canSellNum = parseInt(str.split(" ")[0]);  //可售数量
				var num = parseInt( $(this).val() );
				if(canSellNum < num){
					$(this).val(canSellNum);
					layer.msg("不能超过可售数量！");
				}
			});



			//联系方式
			$("#contactWay").hover(function(){
				var iphone = productDetails.contactPhone;
				if(iphone){
					layer.msg(iphone, {time: 2500});
				}else{
					layer.msg("暂无联系方式！", {time: 2500});
				}
			},function(){

			});


			

			//skuList 数量过多 点击下拉
			// $(".drop-down").on("click", "span", function(){
			// 	if(!$(this).hasClass("drop-up")){
			// 			$(this).parent("").addClass("skuListDivMore");
			// 		$(this).addClass("drop-up");

			// 	}else{
			// 		$(this).removeClass("drop-up");
			// 	}
			// });


			$("#pictureInfo").on({
				onmouseover: function(){
					$(this).addClass("checkLi").siblings().removeClass("checkLi");
				},
				click: function(){
					$(this).addClass("checkLi").siblings().removeClass("checkLi");
					var $url = $(this).find("img").attr("src");
					$(".bigImgBox img").attr("src", $url);
				}
			}, "li");


			//右侧 贴边工具条（购物车，电话，回顶部）
			// $("#rightTools li").each(function(){
			// 	var $toolsRight = $(this).find("a.toolsRight");
			// 	$(this).mouseover(function(){
			// 		$toolsRight.css("background-color", "#ff4835");
			// 		$toolsRight.siblings().stop().animate({right: 40+"px"}, 100);
			// 	});
			// 	$(this).mouseout(function(){
			// 		$toolsRight.css("background-color", "#3d3c3c");
			// 		$toolsRight.siblings().stop().animate({right: -10+"px"}, 100);
			// 	});
			// });

			//下拉选择 省市区 计算运费
 			$("#distribution").on("change", "select", function(){
				var $province = $("#province").find("option:selected").attr("id");
				getFreightPrice(productDetails);
			});

			//图片加载失败以后 调用占位图
			// $("img").error(function(){
			// 	console.log("图片加载失败！");
			// 	$(this).attr('src','../img/placeholder.jpg');
			// });



		});

        woLianw.search({});
        woLianw.buyCartSum(function () {

        })
        /*搜索根据关键词打开商品列表页*/
        $('#repeat_search').on('click','#searchBtn',function () {
            var key = $('#searchkey').val() || '';
            var category = $('#choosecateBtnSpan').text() || '';
            var categoryIds = $('#choosecateBtnSpan').attr('cid') || '';
            window.open(encodeURI('./products/index.html?key='+key+'&category='+category+'&categoryIds='+categoryIds))
        })

        /*搜索框的enter事件*/
        $('#repeat_search').on('keydown','#searchkey',function (e) {
            var key = $(this).val() || '';
            var category = $('#choosecateBtnSpan').text() || '';
            var categoryIds = $('#choosecateBtnSpan').attr('cid') || '';
            if(e.keyCode == 13){
                e.preventDefault()
                window.open(encodeURI('./products/index.html?key='+key+'&category='+category+'&categoryIds='+categoryIds))
            }

        })


		//获取面包屑导航 分类的path
		function goodsDetails(path){
			return path.replace(new RegExp(">","gm"),"&nbsp;>&nbsp;");
		}


		function getFreightPrice(productDetails, _minBuyNum){
			var buyNum = _minBuyNum || productDetails.minBuyNum;
			var provinceId = $("#province").find("option:selected").attr("id");
			if(!provinceId){       //未选择下拉框（当前默认是“请选择”，没有值 provinceId==undefined）
				$("#freightTotalPrice").text("");
			}else if(productDetails.freightType ==1){   //有运费模板的时候
					var arr = [];
					var parameter =	{
						"productId": productDetails.id, // 商品ID
						"number": buyNum, // 购买数量(默认使用最小购买量)
						"weight": productDetails.weight, // 单件重量，单位千克
						"templateId": productDetails.fareTemplateId // 模板ID
					}
					freightParameter.areaId = provinceId;
					arr.push(parameter);
					freightParameter.orderItems = JSON.stringify(arr);
					woLianw.fareOrderFreight(freightParameter, function(data){
						var freightPrice = data.totalAmount;
						if(freightPrice == "0" || freightPrice == "0.00"){
							$("#freightTotalPrice").text("免运费");
						}else{
							$("#freightTotalPrice").text("￥"+freightPrice);
						}

					});
				}else if(productDetails.freightType ==0){
					$("#freightTotalPrice").text("卖家承担运费");
				}else if(productDetails.freightType ==2){
					$("#freightTotalPrice").text("运费到付");
				}
		}



});


</script>

</body>
</html>
